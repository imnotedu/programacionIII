<main class="flex-1 container mx-auto px-4 py-8">
  <a
    href="/tienda"
    class="flex items-center text-muted-foreground hover:text-foreground mb-6"
  >
    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
    </svg>
    Volver a la tienda
  </a>

  <h1 class="text-3xl font-bold mb-8">Panel de Administración</h1>

  <div class="grid lg:grid-cols-2 gap-12">
    <!-- Formulario de Agregar -->
    <div class="bg-card border border-border rounded-xl p-6 shadow-sm h-fit">
      <h2 class="text-xl font-semibold mb-6 flex items-center gap-2">
        <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        Agregar Nuevo Producto
      </h2>

      <form action="/api/products" method="POST" class="space-y-4" enctype="multipart/form-data">
        <div>
          <label class="text-sm font-medium mb-1 block">Nombre del Producto</label>
          <input
            name="name"
            class="input-field w-full"
            placeholder="Ej. Ultra Whey Pro"
            required
          />
        </div>

        <div>
          <label class="text-sm font-medium mb-1 block">Descripción Corta</label>
          <textarea
            name="description"
            class="input-field w-full min-h-[80px]"
            placeholder="Breve descripción..."
            required
          ></textarea>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium mb-1 block">Precio ($)</label>
            <input
              type="number"
              step="0.01"
              name="price"
              class="input-field w-full"
              placeholder="0.00"
              required
            />
            <p class="text-xs text-muted-foreground mt-1">
              Precio regular del producto
            </p>
          </div>
          <div>
            <label class="text-sm font-medium mb-1 block">Categoría</label>
            <select
              name="category"
              class="input-field w-full"
              required
            >
              <option value="Proteínas">Proteínas</option>
              <option value="Rendimiento">Rendimiento</option>
              <option value="Pre-entreno">Pre-entreno</option>
              <option value="Aminoácidos">Aminoácidos</option>
              <option value="Ganadores">Ganadores</option>
              <option value="Vitaminas">Vitaminas</option>
            </select>
          </div>
        </div>

        <!-- Opciones de etiquetas -->
        <div class="space-y-3 p-4 bg-muted/50 rounded-lg">
          <label class="text-sm font-medium block">Etiquetas del Producto</label>

          <div class="flex items-center gap-2">
            <input
              type="checkbox"
              id="isNew"
              name="isNew"
              value="true"
              class="w-4 h-4 text-primary border-border rounded focus:ring-primary"
            />
            <label for="isNew" class="text-sm cursor-pointer">
              Marcar como <span class="badge-new">Nuevo</span>
            </label>
          </div>

          <div class="flex items-center gap-2">
            <input
              type="checkbox"
              id="isSale"
              name="isSale"
              value="true"
              class="w-4 h-4 text-primary border-border rounded focus:ring-primary"
            />
            <label for="isSale" class="text-sm cursor-pointer">
              Marcar como <span class="badge-sale">Oferta</span>
            </label>
          </div>

          <div id="sale-price-container" class="mt-3 hidden">
            <label class="text-sm font-medium mb-1 block">Precio de Oferta ($)</label>
            <input
              type="number"
              step="0.01"
              name="salePrice"
              class="input-field w-full"
              placeholder="0.00"
            />
            <p class="text-xs text-muted-foreground mt-1">
              Precio con descuento (debe ser menor al precio regular)
            </p>
          </div>
        </div>

        <!-- Sección de carga de imagen -->
        <div>
          <label class="text-sm font-medium mb-2 block">Imagen del Producto</label>
          <div class="border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-primary transition-colors">
            <input
              type="file"
              id="image-upload"
              name="image"
              accept="image/*"
              class="hidden"
              required
            />
            <label
              for="image-upload"
              class="cursor-pointer flex flex-col items-center gap-2"
            >
              <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center">
                <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
              </div>
              <div>
                <p class="text-sm font-medium text-foreground">
                  Subir imagen
                </p>
                <p class="text-xs text-muted-foreground mt-1">
                  PNG, JPG, WEBP hasta 5MB
                </p>
              </div>
            </label>
          </div>
          <div id="image-preview" class="mt-4 hidden">
            <img id="preview-img" src="" alt="Vista previa" class="w-full h-48 object-cover rounded-lg" />
          </div>
        </div>

        <button
          type="submit"
          class="btn-primary w-full"
        >
          Publicar Producto
        </button>
      </form>
    </div>

    <!-- Lista de productos -->
    <div class="bg-card border border-border rounded-xl p-6 shadow-sm">
      <h2 class="text-xl font-semibold mb-6">Inventario Actual (<%= products.length %>)</h2>
      <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
        <% products.forEach(function(product) { %>
          <div class="flex items-center justify-between p-3 border rounded-lg bg-background hover:bg-muted/50 transition-colors">
            <div class="flex items-center gap-3 flex-1">
              <img
                src="<%= product.image %>"
                alt="<%= product.name %>"
                class="w-12 h-12 rounded object-cover bg-gray-100"
                loading="lazy"
              />
              <div class="flex-1">
                <div class="flex items-center gap-2">
                  <p class="font-medium text-sm"><%= product.name %></p>
                  <% if (product.isNew) { %>
                    <span class="badge-new text-[10px] px-1.5 py-0.5">Nuevo</span>
                  <% } %>
                  <% if (product.isSale) { %>
                    <span class="badge-sale text-[10px] px-1.5 py-0.5">Oferta</span>
                  <% } %>
                </div>
                <div class="flex items-center gap-2 mt-1">
                  <p class="text-xs font-semibold text-foreground">$<%= product.price.toFixed(2) %></p>
                  <% if (product.originalPrice) { %>
                    <p class="text-xs text-muted-foreground line-through">$<%= product.originalPrice.toFixed(2) %></p>
                    <p class="text-xs text-primary font-medium">
                      -<%= Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100) %>%
                    </p>
                  <% } %>
                </div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <form action="/api/products/<%= product.id %>" method="POST" class="inline" onsubmit="return confirm('¿Eliminar este producto?');">
                <input type="hidden" name="_method" value="DELETE" />
                <button
                  type="submit"
                  class="text-destructive hover:bg-destructive/10 p-2 rounded-full transition-colors"
                  title="Eliminar producto"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </form>
            </div>
          </div>
        <% }); %>
      </div>
    </div>
  </div>
</main>

<script>
// Toggle sale price field
document.getElementById('isSale').addEventListener('change', function() {
  const container = document.getElementById('sale-price-container');
  if (this.checked) {
    container.classList.remove('hidden');
  } else {
    container.classList.add('hidden');
  }
});

// Image preview
document.getElementById('image-upload').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('preview-img').src = e.target.result;
      document.getElementById('image-preview').classList.remove('hidden');
    };
    reader.readAsDataURL(file);
  }
});
</script>
